# Dots and Boxes Game System – 5WHY 기반 전체 문서 스택

> 원본 `AI-Agent-System-gaebal-jeonce-munseo-seutaeg_5why.md`를 Dots and Boxes 디지털 게임(교육용 보드게임 앱)에 맞게 변환한 버전이다. 에이전트 시스템 용어를 게임 시스템 용어로 치환하고, 각 레이어를 게임/교육 도메인에 최적화했다.

## 0. Meta Layer – 문서 거버넌스 & 5WHY 시스템

### 0.1 Documentation Framework Governance
- Guidebook: **Dots and Boxes Game System Guidebook**  
  - 전체 비전, 레이어 구조, 이해관계자, 운영 원칙 정리.
- Spec: PRD, TRD/TSD, GDD, API Spec, ERD, Test Plan, Runbook, Incident Report, Eval Plan 등.
- Playbook: 라이브오퍼레이션, 시즌제 운영, 이벤트·랭킹 운영, 난이도 튜닝 플레이북.
- Runbook: 장애 대응, 롤백, 데이터 이슈, 보안 사고 대응.
- Versioning & Changelog 규칙: semver, 문서 파일 네이밍 규칙(`dots-game-arch-spec.v1.md`).

### 0.2 Template Library
- PRD, GDD, Feature Spec, Tech Spec, API Spec, Test Plan, Runbook, Incident Report, Eval Plan 템플릿.
- ERD, 시퀀스 다이어그램, 유저 플로우 등에 사용할 Mermaid 템플릿.
- Antigravity + 바이브 코딩 워크스페이스용 기본 템플릿 세트.

### 0.3 Writing Style Guide
- 타깃: 초등학생, 교사, 학부모, 게임 개발자.
- 톤: 명확·간결·친근, 교육적 맥락 강조.
- 용어: 체인(chain), 루프(loop), 이중 교차(double cross), 난이도, 경기, 세션, 교실 모드 등 도메인 용어 정의.

### 0.4 5WHY System for Governance
- PM, Architect, Security, Ops, Game Design, Education Expert가 주요 결정에 대해 5WHY 문답 기록.
- 예: "왜 Game Module Registry가 필요한가?" → 치트 방지, 거버넌스, 릴리즈 관리 관점에서 5WHY 전개.

---

## 1. Product Layer – 비전·전략

### 1.1 Product Vision & Strategy
- 목표: **Dots and Boxes를 통해 초등 수학·전략 사고·공간 지능을 즐겁게 학습**하게 하는 것.
- 타깃:
  - 만 4세 이상 어린이(가정용)
  - 초등 1–4학년 학생(교실/방과후 수업)
  - 교사·학부모(학습 도구)
- 주요 가치 제안:
  - 규칙이 단순하지만 깊은 전략을 갖는 고전 게임을 디지털로 재해석.
  - 체인/루프·이중 교차 등 고급 전략을 시각적으로 이해하도록 지원.
  - 교실 모드와 학습 리포트로 교육 현장에 쉽게 도입 가능.
- KPI/OKR 예시:
  - 튜토리얼 완료율 70% 이상.
  - 7일/30일 리텐션 목표치.
  - 교실 모드 월간 활성 클래스 수.

### 1.2 Product Requirements Document (PRD)
- Executive Summary
- Problem Statement: "수학/전략 게임을 교육적으로 즐길 수 있는 디지털 도구 부족" 등.
- User Personas: 어린이, 교사, 학부모.
- Goals & KPIs: 학습·리텐션·참여도 지표.
- Scope & Out of Scope: 
  - v1: 싱글·로컬 2인·교실 모드.
  - 비범위: 실시간 글로벌 e스포츠화 등.

### 1.3 Feature Release Strategy
- MVP → Phase 1 → Phase 2… 로드맵.
- MoSCoW 우선순위.
- 베타 테스트/파일럿 클래스 운영 계획.

### 1.4 ROI & Economics
- 무료/유료 모델, 교사용 구독, 코스메틱 판매 등 시나리오.
- 서버/LLM 비용과 수익의 밸런스.

---

## 2. Feature & UX Layer – 기능 명세·유저 플로우

### 2.1 Feature Specification & User Stories
- 핵심 기능: 
  - Dots and Boxes 대국(싱글/로컬/온라인)
  - 튜토리얼·연습 모드
  - 교실 모드
  - AI 봇 난이도 선택
  - 전략 해설/힌트
- 각 기능별 User Story + Acceptance Criteria.

### 2.2 Use Case & User Flow
- 온보딩 → 난이도 선택 → 튜토리얼 1판 → 연습 모드 → 대전.
- 교사: 로그인 → 세션 생성 → 학생 초대 → 수업 운영 → 리포트 확인.

### 2.3 Game Mode Capability Matrix
- 모드별 스펙: 
  - 보드 크기(4x4 ~ 8x8)
  - AI 사용 여부
  - 온라인 여부
  - 교실 통계 제공 여부 등.

### 2.4 Non‑Functional Requirements (NFR)
- 응답성, 프레임레이트, 지연 허용 범위.
- 오프라인 플레이(싱글) 지원.
- 다국어, 접근성, 안정성.

---

## 3. System & Tech Layer – TRD/TSD

### 3.1 System Architecture Spec (TRD/TSD)
- 클라이언트/서버 구조.
- 주요 모듈: Game Client, Game Server, Matchmaking, Classroom Service, Analytics, Auth.
- Antigravity 통합 구조.

### 3.2 Game Logic & AI Bot Architecture
- 보드 상태 모델, 합법 수 검증, 승패 판정.
- AI 전략 엔진: 체인/루프 탐지, 이중 교차 구현, 난이도별 의도적 실수.

### 3.3 Module Graph / Node Network (선택)
- 게임 모듈 간 데이터 흐름: 
  - Game Client ↔ Game Server ↔ Ranking
  - Tutorial Engine ↔ Game Logic.

### 3.4 Data Schema Design
- ERD: User, Profile, Game, Move, BoardState, Match, TutorialProgress, ClassSession, Ranking 등.

### 3.5 API Integration Spec
- REST/WebSocket API 정의.
- Rate limit, 인증, 에러 코드.

### 3.6 Full Tech Stack Definition
- 클라이언트 프레임워크, 서버 런타임, DB, 캐시, 메시지 브로커, 관측성 스택.

---

## 4. Game Logic / Tutorial / Strategy Layer

### 4.1 Game Rule Engine Spec
- 보드 초기화, 턴 진행, 선 긋기 검증, 상자 완성·추가 턴 규칙.
- 변형 규칙(대각선 허용, 추가 턴 없음, 퍼즐 모드 등)의 플래그.

### 4.2 Strategy Engine & Hint System
- 체인/루프 탐지 알고리즘.
- 힌트: "안전한 선", "위험한 선", "긴 체인 먼저 열지 않기" 등.
- AI 봇 난이도별 전략 테이블.

### 4.3 Tutorial Script System
- 튜토리얼 단계 시나리오 JSON 스키마.
- 규칙/전략 설명용 텍스트·음성/하이라이트 연동.

### 4.4 Game Rules & Guardrails
- 공정성 규칙, 치트 방지(불법 클라이언트 방지, 서버 검증).
- 만 4세 모드에서의 단순화 규칙.

### 4.5 Game Memory & Replay
- Move 로그, 리플레이 재생 로직.
- 학생별 실수 패턴 기록(3번째 변을 자주 만드는 위치 등).

### 4.6 Evaluation & Feedback Integration
- 전략 엔진/튜토리얼 효과 측정 지표.
- A/B 테스트용 플래그와 이벤트.

---

## 5. Data & Governance Layer

### 5.1 Data Governance Policy
- 아동 데이터 최소 수집, 익명 식별자.
- 보존 기간, 삭제/정정 요청 처리.

### 5.2 Knowledge & Content Architecture
- 게임 내 규칙 설명, 전략 팁, 수업 자료를 위한 콘텐츠 저장 구조.

### 5.3 Player Memory Governance
- 플레이 기록, 리플레이, 튜토리얼 진행 상황의 관리 정책.

### 5.4 Data Catalog & Glossary
- 도메인 용어 정의: 세션, 체인, 루프, 체인 길이, 실수 유형 등.

---

## 6. Development Workflow & Code Structure

### 6.1 Development Workflow Spec
- Git 브랜치 전략, PR 리뷰, CI 통합.
- Antigravity 바이브 코딩에서의 협업 룰.

### 6.2 Coding Standards & AI Collaboration Guide
- 언어별 스타일 가이드, 네이밍 규칙.
- LLM 이용 패턴(테스트 코드 제안, 전략 검증 등).

### 6.3 Directory & Module Structure
- `apps/game-client`, `apps/game-server`, `packages/game-logic`, `infra`, `docs` 구조.

### 6.4 Reusable Libraries & Patterns
- 공통 보드 렌더러, 턴 엔진, 튜토리얼 엔진, UI 컴포넌트.

---

## 7. Evaluation & Testing Layer

### 7.1 Test Strategy & Plan
- Unit, Integration, E2E, UI 테스트 범위.

### 7.2 Game & AI-specific Testing
- 규칙 엔진·AI 봇·힌트 시스템·튜토리얼의 도메인 특화 테스트.

### 7.3 Evaluation Framework
- 게임 완료율, 튜토리얼 성공률, 봇 밸런스 지표.

### 7.4 Quality Gate & Release Criteria
- dev/stage/prod 진입 조건, 버그·성능 기준.

---

## 8. Observability & Reliability Layer (GameOps)

### 8.1 Observability Architecture
- 로그, 메트릭, 트레이스 수집 스택.

### 8.2 Reliability SLO Spec
- 로그인, 매치, 게임 서버 요청에 대한 SLI/SLO.

### 8.3 Monitoring Dashboard Design
- 동시 접속, 매치 대기, 에러율, 튜토리얼 이탈률 그래프.

### 8.4 Incident Response Runbooks
- 주요 장애 유형별 대응 절차.

### 8.5 Cost Management & Optimization
- 서버·네트워크·LLM 비용 관리.

---

## 9. Trust & Safety Layer

### 9.1 Threat Model & Risk Assessment
- 부적절 닉네임/채팅, 치트, 계정 탈취 등의 위협 모델링.

### 9.2 Identity & Access Control
- 학생/교사/학부모/관리자 역할 정의.

### 9.3 API & Match Security
- 인증·인가, 요청 검증, 레이트 리밋.

### 9.4 Data Privacy Compliance
- 아동 보호법·GDPR/CCPA 수준에 맞는 데이터 처리.

### 9.5 Content Safety Guardrails
- 채팅 필터링, 신고/차단, Human-in-the-loop 모더레이션.

### 9.6 Security Operations
- 보안 이벤트 모니터링, 취약점 관리.

---

## 10. Cloud & Infrastructure Layer

### 10.1 Cloud Network Architecture
- VPC, 서브넷, Security Group, Load Balancer, CDN.

### 10.2 Compute Runtime
- K8s/Serverless/VM 기반 게임 서버·매치메이킹·API 런타임.

### 10.3 Infrastructure as Code (IaC)
- Terraform/Helm 등으로 인프라 정의.

### 10.4 CI/CD Release Pipeline
- 빌드, 테스트, 배포, 롤백, 피처 플래그 전략.

### 10.5 Secrets Management
- Secrets Manager/Vault로 키 관리.

---

## 11. Governance & Compliance Layer

### 11.1 Game Governance Framework
- Discovery → Design → Develop → Deploy → Review 사이클.
- RACI 매트릭스.

### 11.2 Policy Stack
- Game Policy (규칙·밸런스 변경 원칙).
- Data Governance Policy.
- Security & Privacy Policy.
- AI/LLM 사용 정책(선택적 튜터 모듈에 한정).

### 11.3 Game Module Inventory Registry
- Game Mode, AI Bot, Analytics, Classroom 등 모듈 인벤토리.

### 11.4 Training & Onboarding
- 팀원 교육, 교사용 튜토리얼, 파트너 온보딩.

### 11.5 Audit & Compliance
- 로그·정책·릴리즈 이력 관리.
- SOC2/ISO, 교육 관련 규정 대응이 필요한 경우의 체크리스트.

---

## 12. Documentation & CX Layer

### 12.1 Developer Documentation
- Setup Guide, Architecture Overview, API Reference, Coding Standards, Contribution Guide.

### 12.2 User-facing Documentation
- 규칙 설명, 튜토리얼, 전략 팁, FAQ, 트러블슈팅.

### 12.3 Legal Policy Docs
- 이용약관, 개인정보 처리방침, AUP, DPA, SLA, Responsible Game/AI Guidelines.

### 12.4 Changelog & Release Notes
- 버전별 변경 사항, 브레이킹 체인지.

---

이 md는 원본 AI Agent System 5WHY 문서 스택을 "Dots and Boxes Game System"에 맞게 재구성한 상위 레벨 정의다. 세부 항목은 필요에 따라 각 별도 md(예: `prd.md`, `gdd.md`, `game-logic-spec.md`)로 분리하여 확장한다.
